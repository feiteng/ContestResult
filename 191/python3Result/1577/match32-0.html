<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>335_john35452.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>335_john35452.py</CENTER></H3><HR>
<PRE>
class Solution:
    def getProbability(self, balls: List[int]) -&gt; float:
        
        def dfs(current, count, dp):
            if count == total //2:
                diff1 = 0
                diff2 = 0
                permu = math.factorial(count)
                for k in range(len(balls)):
                    diff1 += int(current[k]&gt;0)
                    if balls[k] &gt; 0:
                        diff2 += 1
                        permu //= math.factorial(balls[k])
                #print(current, balls)
                return int(diff1 == diff2)*permu
            t_current = tuple(current)
            if t_current not in dp:
                result = 0
                for k in range(len(balls)):
                    if balls[k] &gt; 0:
                        current[k] += 1
                        balls[k] -= 1
                        result += get(current, count + 1, dp)
                        balls[k] += 1
                        current[k] -= 1
                dp[t_current] = result
            return dp[t_current]
        
        def get(current, count, index, dp):
            if index == len(balls):
                if count != target:
                    return []
<A NAME="0"></A>                else:
                    diff1 = 0
                    diff2 = 0
                    for k in range(len<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match32-1.html#0',3,'match32-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>(balls)):
                        if current[k] &gt; 0:
                            diff1 += 1
                        if balls[k]-current[k] &gt; 0:
                            diff2 += 1
                    #print(current, permu1, permu2)
                    if</B></FONT> diff1 == diff2:
                        return [list(current)]
                    else:
                        return []
             
            result = []
            if balls[index] &gt; 0:
                for k in range(balls[index]+1):
                    if count + k &lt;= target:
                        current[index] += k
                        result.extend(get(current, count + k, index+1, dp))
                        current[index] -= k
                    else:
                        break
            else:
                result.extend(get(current, count, index+1, dp))

            return result

        total = sum(balls)
        target = total // 2
        kinds = math.factorial(total)
        for k in balls:
            if k &gt; 0:
                kinds //= math.factorial(k)
        #ans = get([0]*len(balls), 0, {})
        ans = get([0]*len(balls), 0, 0, {})
        #print(ans, kinds)
        count = 0
        for k in ans:
            permu1 = permu2 = math.factorial(target)
            for s in range(len(balls)):
                if k[s] &gt; 0:
                    permu1 //= math.factorial(k[s])
                if balls[s] - k[s] &gt; 0:
                    permu2 //= math.factorial(balls[s]-k[s])
            count += permu1*permu2
                    
                
        return count/kinds
    
</PRE>

</BODY>
</HTML>
