<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>89_noxe.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>89_noxe.cpp</CENTER></H3><HR>
<PRE>
int f[7][1&lt;&lt;10][7][7];
int mp[1&lt;&lt;10][1&lt;&lt;10];
int cnt[1&lt;&lt;10][2];
int ts[6][6][7][7];
<A NAME="0"></A>
class Solution {
public:
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match31-1.html#0',3,'match31-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    void init() {
        ts[4][4][0][0]=0;
ts[4][4][0][1]=40;
ts[4][4][0][2]=120;
ts[4][4][0][3]=200;
ts[4][4][0][4]=320;
ts[4][4][0][5]=400;
ts[4][4][0][6]=520;
ts[4][4][1][0]=120;
ts[4][4][1][1]=160;
ts[4][4][1][2]=240;
ts[4][4][1][3]=320;
ts[4][4][1][4]=440;
ts[4][4][1][5]=520;
ts[4][4][1][6]=640;
ts[4][4][2][0]=240;
ts[4][4][2][1]=280;
ts[4][4][2][2]=360;
ts[4][4][2][3]=440;
ts[4][4][2][4]=560;
ts[4][4][2][5]=640;
ts[4][4][2][6]=760;
ts[4][4][3][0]=360;
ts[4][4][3][1]=400;
ts[4][4][3][2]=480;
ts[4][4][3][3]=560;
ts[4][4][3][4]=680;
ts[4][4][3][5]=760;
ts[4][4][3][6]=880;
ts[4][4][4][0]=480;
ts[4][4][4][1]=520;
ts[4][4][4][2]=600;
ts[4][4][4][3]=680;
ts[4][4][4][4]=800;
ts[4][4][4][5]=880;
ts[4][4][4][6]=990;
ts[4][4][5][0]=600;
ts[4][4][5][1]=640;
ts[4][4][5][2]=720;
ts[4][4][5][3]=800;
ts[4][4][5][4]=910;
ts[4][4][5][5]=990;
ts[4][4][5][6]=1100;
ts[4][4][6][0]=720;
ts[4][4][6][1]=760;
ts[4][4][6][2]=840;
ts[4][4][6][3]=920;
ts[4][4][6][4]=1020;
ts[4][4][6][5]=1080;
ts[4][4][6][6]=1140;
ts[4][5][0][0]=0;
ts[4][5][0][1]=40;
ts[4][5][0][2]=120;
ts[4][5][0][3]=200;
ts[4][5][0][4]=320;
ts[4][5][0][5]=400;
ts[4][5][0][6]=520;
ts[4][5][1][0]=120;
ts[4][5][1][1]=160;
ts[4][5][1][2]=240;
ts[4][5][1][3]=320;
ts[4][5][1][4]=440;
ts[4][5][1][5]=520;
ts[4][5][1][6]=640;
ts[4][5][2][0]=240;
ts[4][5][2][1]=280;
ts[4][5][2][2]=360;
ts[4][5][2][3]=440;
ts[4][5][2][4]=560;
ts[4][5][2][5]=640;
ts[4][5][2][6]=760;
ts[4][5][3][0]=360;
ts[4][5][3][1]=400;
ts[4][5][3][2]=480;
ts[4][5][3][3]=560;
ts[4][5][3][4]=680;
ts[4][5][3][5]=760;
ts[4][5][3][6]=880;
ts[4][5][4][0]=480;
ts[4][5][4][1]=520;
ts[4][5][4][2]=600;
ts[4][5][4][3]=680;
ts[4][5][4][4]=800;
ts[4][5][4][5]=880;
ts[4][5][4][6]=1000;
ts[4][5][5][0]=600;
ts[4][5][5][1]=640;
ts[4][5][5][2]=720;
ts[4][5][5][3]=800;
ts[4][5][5][4]=920;
ts[4][5][5][5]=1000;
ts[4][5][5][6]=1120;
ts[4][5][6][0]=720;
ts[4][5][6][1]=760;
ts[4][5][6][2]=840;
ts[4][5][6][3]=920;
ts[4][5][6][4]=1040;
ts[4][5][6][5]=1120;
ts[4][5][6][6]=1230;
ts[5][4][0][0]=0;
ts[5][4][0][1]=40;
ts[5][4][0][2]=120;
ts[5][4][0][3]=200;
ts[5][4][0][4]=320;
ts[5][4][0][5]=400;
ts[5][4][0][6]=520;
ts[5][4][1][0]=120;
ts[5][4][1][1]=160;
ts[5][4][1][2]=240;
ts[5][4][1][3]=320;
ts[5][4][1][4]=440;
ts[5][4][1][5]=520;
ts[5][4][1][6]=640;
ts[5][4][2][0]=240;
ts[5][4][2][1]=280;
ts[5][4][2][2]=360;
ts[5][4][2][3]=440;
ts[5][4][2][4]=560;
ts[5][4][2][5]=640;
ts[5][4][2][6]=760;
ts[5][4][3][0]=360;
ts[5][4][3][1]=400;
ts[5][4][3][2]=480;
ts[5][4][3][3]=560;
ts[5][4][3][4]=680;
ts[5][4][3][5]=760;
ts[5][4][3][6]=880;
ts[5][4][4][0]=480;
ts[5][4][4][1]=520;
ts[5][4][4][2]=600;
ts[5][4][4][3]=680;
ts[5][4][4][4]=800;
ts[5][4][4][5]=880;
ts[5][4][4][6]=1000;
ts[5][4][5][0]=600;
ts[5][4][5][1]=640;
ts[5][4][5][2]=720;
ts[5][4][5][3]=800;
ts[5][4][5][4]=920;
ts[5][4][5][5]=1000;
ts[5][4][5][6]=1120;
ts[5][4][6][0]=720;
ts[5][4][6][1]=760;
ts[5][4][6][2]=840;
ts[5][4][6][3]=920;
ts[5][4][6][4]=1040;
ts[5][4][6][5]=1120;
ts[5][4][6][6]=1230;
ts[5][5][0][0]=0;
ts[5][5][0][1]=40;
ts[5][5][0][2]=120;
ts[5][5][0][3]=200;
ts[5][5][0][4]=320;
ts[5][5][0][5]=400;
ts[5][5][0][6]=520;
ts[5][5][1][0]=120;
ts[5][5][1][1]=160;
ts[5][5][1][2]=240;
ts[5][5][1][3]=320;
ts[5][5][1][4]=440;
ts[5][5][1][5]=520;
ts[5][5][1][6]=640;
ts[5][5][2][0]=240;
ts[5][5][2][1]=280;
ts[5][5][2][2]=360;
ts[5][5][2][3]=440;
ts[5][5][2][4]=560;
ts[5][5][2][5]=640;
ts[5][5][2][6]=760;
ts[5][5][3][0]=360;
ts[5][5][3][1]=400;
ts[5][5][3][2]=480;
ts[5][5][3][3]=560;
ts[5][5][3][4]=680;
ts[5][5][3][5]=760;
ts[5][5][3][6]=880;
ts[5][5][4][0]=480;
ts[5][5][4][1]=520;
ts[5][5][4][2]=600;
ts[5][5][4][3]=680;
ts[5][5][4][4]=800;
ts[5][5][4][5]=880;
ts[5][5][4][6]=1000;
ts[5][5][5][0]=600;
ts[5][5][5][1]=640;
ts[5][5][5][2]=720;
ts[5][5][5][3]=800;
ts[5][5][5][4]=920;
ts[5][5][5][5]=1000;
ts[5][5][5][6]=1120;
ts[5][5][6][0]=720;
ts[5][5][6][1]=760;
ts[5][5][6][2]=840;
ts[5][5][6][3]=920;
ts[5][5][6][4]=1040;
ts[5][5][6][5]=1120;
ts[5][5][6][6]=1240;</B></FONT>

    }
    
    pair&lt;int, int&gt; p[1024];
    int getMaxGridHappiness(int m, int n, int ic, int ec) {
        if (m &gt;= 4 &amp;&amp; n &gt;= 4) {
            init();
            return ts[m][n][ic][ec];
        }
        memset(f, 0xff, sizeof f);
        f[0][0][0][0] = 0;
        int e = n*2;
        
        for (int i = 0; i &lt; (1&lt;&lt;e); ++i) {
            int s = 0;
            int nums[6], k = 0;
            for (int j = 0; j &lt; e; j += 2) {
                int t = i &gt;&gt; j &amp; 3;
                if (t == 0 || t == 3) nums[k++] = 0;
                else if (t == 1) nums[k++] = 120;
                else nums[k++] = 40;
            }
            for (int j = 0; j &lt; n; ++j) {
                s += nums[j];
                if (nums[j] == 120) {
                    if (j &gt; 0 &amp;&amp; nums[j-1]&gt;0) s-=30;
                    if (j+1&lt; n &amp;&amp; nums[j+1]&gt;0) s-=30;
                } else if (nums[j] == 40) {
                    if (j&gt;0 &amp;&amp; nums[j-1]&gt;0) s += 20;
                    if (j+1&lt;n &amp;&amp; nums[j+1]&gt;0) s += 20;
                }
                p[i] = {i, s};
            }
        }
        for (int i = 0; i &lt; (1&lt;&lt;e); ++i) {
            for (int j = 0; j &lt; (1&lt;&lt;e); ++j) {
                int s = 0;
                for (int k = 0; k &lt; e; k += 2) {
                    int x = i &gt;&gt; k &amp; 3;
                    int y = j &gt;&gt; k &amp; 3;
                    if (x &gt; 0 &amp;&amp; y &gt; 0 &amp;&amp; x != 3 &amp;&amp; y != 3) {
                        if (x == 1) s -= 30; else if (x == 2) s += 20;
                        if (y == 1) s -= 30; else if (y == 2) s += 20;
                    }
                }
                mp[i][j] = s;
            }
            int z1 = 0, z2 = 0;
            for (int k = 0; k &lt; e; k += 2) {
                int x = i &gt;&gt; k &amp; 3;
                if (x == 1) ++z1;
                else if (x == 2) ++z2;
            }
            cnt[i][0] = z1; cnt[i][1] = z2;
        }
        
        for (int i = 0; i &lt; m; ++i) {
            for (int j = 0; j &lt; (1&lt;&lt;e); ++j) {
                for (int x = 0; x &lt;= ic; ++x) {
                    for (int y = 0; y &lt;= ec; ++y) {
                        if (f[i][j][x][y] &gt;= 0) {
                            //printf(&quot;f[%d][%d][%d][%d]=%d\n&quot;,i,j,x,y,f[i][j][x][y]);
                            for (int k = 0; k &lt; (1&lt;&lt;e); ++k) {
                                int tx = x+cnt[k][0], ty = y + cnt[k][1];
                                if (tx &lt;= ic &amp;&amp; ty &lt;= ec) {
                                    f[i+1][k][tx][ty] = max(f[i+1][k][tx][ty], f[i][j][x][y] + p[k].second + mp[j][k]);
                                }
                            }
                        }
                    }
                }
            }
        }
        
        int ans = 0;
        for (int i = 0; i &lt; (1&lt;&lt;e); ++i) {
            for (int x=0;x&lt;=ic;++x)
                for(int y=0;y&lt;=ec;++y)
                    ans = max(ans, f[m][i][x][y]);
        }
        return ans;
    }
};
</PRE>
</BODY>
</HTML>
