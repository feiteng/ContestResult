<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>85_xh286286.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>85_xh286286.cpp</CENTER></H3><HR>
<PRE>
<A NAME="3"></A><A NAME="2"></A><A NAME="1"></A><A NAME="0"></A>vector&lt; vector&lt; vector&lt; vector&lt; int&gt; &gt; &gt; &gt; zzz = 

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match2-1.html#0',3,'match2-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{{{{0,40},{120,120}},{{0,40,120},{120,150,150},{180,180,180}},{{0,40,120,200},{120,160,230,230},{240,260,260,260},{240,260,260,260}},{{0,40,120,200,280},{120,160,240,310,310},{240,270,340,340,340},{300,320,340,340,340},{300,320,340,340,340}},{{0,40,120,200,280,360},{120,160,240,320,390,390},{240,280,350,420,420,420},{360,380,400,420,420,420},{360,380,400,420,420,420},{360,380,400,420,420,420}}},{{{0,40,120,200,320},{120,160,230,300,320},{240,260,280,300,320},{240,260,280,300,320},{240,260,280,300,320}},{{0,40,120,200,320,400,520},{120,160,240,320,430,500,520},{240,280,350,420,480,500,520},{360,380,400,460,480,500,520},{360,380,440,460,480,500,520},{360,380,440,460,480,500,520},{360,380,440,460,480,500,520}},{{0,40,120,200,320,400,520},{120,160,240,320,440,520,630},{240,280,360,440,550,610,680},{360,400,470,530,590,660,680},{480,500,520,570,640,660,680},{480,500,520,570,640,660,680},{480,500,520,570,640,660,680}},{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,750},{360,400,480,560,670,730,790},{480,520,590,650,710,770,840},{600,620,640,690,710,770,840},{600,620,640,690,710,770,840}}},{{{0,40,120,200,320,400,520},{120,160,240,320,440,520,630},{240,280,360,440,550,630,740},{360,400,470,550,660,720,780},{480,520,580,640,700,760,780},{600,610,620,640,700,760,780},{600,610,620,640,700,760,780}},{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,760},{360,400,480,560,670,750,870},{480,520,600,680,780,850,960},{600,640,710,780,830,890,960},{720,740,760,810,870,890,960}},{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,760},{360,400,480,560,680,760,880},{480,520,600,680,800,880,990},{600,640,720,800,910,990,1100},{720,760,830,910,1020,1080,1130}}},{{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,760},{360,400,480,560,680,760,880},{480,520,600,680,800,880,990},{600,640,720,800,910,990,1100},{720,760,840,920,1020,1080,1140}},{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,760},{360,400,480,560,680,760,880},{480,520,600,680,800,880,1000},{600,640,720,800,920,1000,1120},{720,760,840,920,1040,1120,1230}}},{{{0,40,120,200,320,400,520},{120,160,240,320,440,520,640},{240,280,360,440,560,640,760},{360,400,480,560,680,760,880},{480,520,600,680,800,880,1000},{600,640,720,800,920,1000,1120},{720,760,840,920,1040,1120,1240}}}};</B></FONT><FONT color="#f63526"><A HREF="javascript:ZweiFrames('match2-1.html#1',3,'match2-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B></B></FONT><FONT color="#77bfc7"><A HREF="javascript:ZweiFrames('match2-1.html#2',3,'match2-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B></B></FONT><FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match2-1.html#3',3,'match2-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B></B></FONT>


class Solution {
public:
    
    int z[6][7][7][250];
    int m, n;
    int total = 0;
    
    pair&lt;int, int&gt; dis(int ma, vector&lt;int&gt; &amp;z) {
        //cout&lt;&lt;&quot;ma &quot;&lt;&lt;ma&lt;&lt;endl;
        if (z.size()==0) z.resize(m);
        int a = 0, b = 0;
        for (int i=0; i&lt;m; ++i) {
            z[i] = ma %3;
            if (z[i] ==1) ++a;
            else if (z[i] ==2) ++b; 
            ma/=3;
        }
        //for (int i=0; i&lt;m; ++i) cout&lt;&lt;z[i]&lt;&lt;' '; cout&lt;&lt;endl;
        return {a,b};
    }
    
    int dfs(int h, int ti, int te, int ma) {
        if (h==0) return 0;
        if (ti==0 &amp;&amp; te ==0) return 0;
        int &amp;r  = z[h][ti][te][ma];
        if (r&gt;=0) return r;
        vector&lt;int&gt; z1, z2;
        dis(ma, z1);
        r = 0;
        for (int ma2 = 0; ma2 &lt;total; ++ma2) {
            auto [a,b] = dis(ma2, z2);
            if (a&gt;ti || b&gt; te) continue;
            int v = 0;
            for (int i=0; i&lt;m; ++i) {
                int t = z1[i] * z2[i];
                switch(t) {
                    case 1: v-= 60; break;
                    case 2: v-= 10;break;
                    case 4: v+= 40;break;
                }
                switch(z2[i]) {
                    case 1: v+= 120; break;
                    case 2: v+= 40; break;
                }
                if (i&gt;0)  t = z2[i-1] * z2[i];
                else t = 0;
                switch(t) {
                    case 1: v-= 60; break;
                    case 2: v-= 10;break;
                    case 4: v+= 40;break;
                }
            }
            int v1 = dfs(h-1, ti - a, te - b, ma2);
            //cout&lt;&lt;v+v1&lt;&lt;endl;
            if (h == 3)  {
                //cout&lt;&lt;ma2 &lt;&lt;' '&lt;&lt; v&lt;&lt;endl;
            }
            r = max(r, v+ v1);
        }
        //cout&lt;&lt;h &lt;&lt;' '&lt;&lt;ti&lt;&lt;' '&lt;&lt;te &lt;&lt;' '&lt;&lt; ma&lt;&lt; &quot;: &quot;&lt;&lt;r&lt;&lt;endl;
        return r;
    }
    int getMaxGridHappiness(int _m, int _n, int introvertsCount, int extrovertsCount) {
        m = _m, n = _n;
        
        if (n&gt;m) swap(n,m);
        
        return zzz[n-1][m-n][introvertsCount][extrovertsCount];
        
        if (n)
        memset(z,-1, sizeof(z));
        total = 1;
        int t = m;
        while (t--)  total *= 3;
        cout&lt;&lt;&quot;===&quot;&lt;&lt;total &lt;&lt; endl;
        int r = dfs(n,  introvertsCount, extrovertsCount, 0 );
        return r;
    }
};
</PRE>
</BODY>
</HTML>
